# 相机触发

## 1. VIO 系统

###1.1 基本概念

VIO 即 视觉惯性里程计 ， 也叫视觉惯性系统，是融合**相机**和**IMU**数据实现 **SLAM**   的算法。

根据融合框架的区别又分为**紧耦合**和**松耦合**，松耦合中**视觉运动估计**和**惯导运动估计系统**是两个独立的模块，将每个模块的输出结果进行融合；而紧耦合则是使用两个传感器的原始数据共同估计一组变量，传感器的噪声也是相互影响的。紧耦合算法上比较复杂，但充分利用了传感数据，可以实现更好的效果，是目前研究的重点。

###1.2 IMU 和 相机的差别与互补性

**IMU**： IMU测得的角速度和加速度都存在**明显的漂移**（Drift），使得积分两次得到的位姿数据非常不可靠。但是，对于**短时间内的快速运动**，IMU能够提供一些较好的估计。这正是相机的弱点。当运动过快时，（卷帘快门的）相机会出现运动模糊，或者两帧之间重叠区域太少以至于无法进行特征匹配，所以**纯视觉SLAM非常害怕快速的运动**。

**相机**： 相比于IMU，**相机数据基本不会有漂移**。如果相机放在原地固定不动，那么（在静态场景下）视觉SLAM的位姿估计也是固定不动的。所以，相机数据可以有效地估计并修正IMU读数中的漂移，使得在慢速运动后的位姿估计依然有效。

所以相机和 IMU 融合有很好的**互补性**，将二者估计的位姿序列对齐可以估计出相机轨迹的真实尺度，而且 IMU 可以很好地预测出图像帧的位姿以及上一时刻特征点在下帧图像的位置，提高特征跟踪算法匹配速度和应对快速旋转的算法鲁棒性。

### 1.3 融合方案

**松耦合**：将 IMU 定位与视觉的位姿直接后处理融合，融合过程对二者本身不产生影响，典型方案为**卡尔曼滤波器**。

**紧耦合**：融合过程本身会影响视觉和 IMU 中的参数（如 IMU 的零偏和视觉的尺度）典型方案为 MSCKF 和非线性优化。



## 2. IMU

IMU 全称 inertial measurement unit, 即**惯性测量单元**。它由三个单轴的加速度计和三个单轴的陀螺仪组成。**加速度计**检测物体在载体坐标系统独立三轴的加速度信号，而**陀螺仪**检测载体相对于导航坐标系的角速度信号，对这些信号处理了后，可以解算出物体的位姿。有些还加上了三个**磁力计**，用卡尔曼或者互补滤波等算法为用户提供拥有绝对参考的俯仰角，横滚角和航向角。

值得注意的是，IMU提供的是**一个相对的定位信息**，它的作用是测量**相对于起点**物体所运动的路线，所以它并不能提供你所在的具体位置的信息。



## 3. SLAM  算法

同时解决定位和地图构建问题。VIO可以视作SLAM视觉算法的进阶版。



## 4.时间戳对齐

通常，VIO系统对两个传感器进行采样，获得相应的数据（图像、IMU数据）与对应的采样时间戳，VIO系统一般忽略IMU与相机时间偏差，认为IMU和相机时间是同步和对齐的。然而由于**硬件系统的触发延时、传输延时和没有准确同步时钟等问题**，IMU和相机之间通常**存在时间偏差**，估计并纠正这个偏差将有效提升VIO系统的性能。

![图1-2 相机和IMU数据流时间不对齐](https://img-blog.csdnimg.cn/img_convert/0d1fa0ffb13b28ba43854afbb1f8890e.png)

上方为相机真实的采样时间点，下方为对应采样记录的时间戳，相机时间戳与真实采样时间存在一个td的时间偏差。

### 4.1 法一：单目视觉惯性系统的在线时间校准

通过联合优化时间偏移，相机和IMU状态以及SLAM系统中的特征位置来实现实践偏移校准，属于一个通用模型。

核心：假设时间偏移是一个常数但未知的变量，通过在线估计它以及相机和 IMU 状态以及 SLAM 系统中的特征位置来校准它。属于一个通用因素，可以很容易地用于其他基于特征的视觉惯性优化框架。

















